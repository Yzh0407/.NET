## 本节目标

1. 集合的使用

   ​	ArrayList类：动态数组

   ​	Hashtable类：哈希表

2. 泛型集合的定义和使用

    List<T> 类：列表

    Dictionary<K,V> 类：字典

## 一、集合

### 集合简介

数组是一种指定长度和数据类型的对象，在实际应用中有一定的局限性。

**集合与数组比较类似，都用于存放一组值，集合的长度能根据需要更改，也允许存放任何数据类型的值。**

集合中提供了特定的方法能直接操作集合中的数据，并提供了不同的集合类来实现特定的功能。

**集合简单的说就是数组的升级版。**他可以动态的对集合的长度（也就是集合内最大元素的个数）进行定义和维护！

所有集合类或与集合相关的接口命名空间都是 **System.Collection**，在该命名空间中提供的常用接口如下表所示。

| **接口名称**          | **作用**                                                     |
| --------------------- | ------------------------------------------------------------ |
| IEnumerable           | 用于迭代集合中的项，该接口是一种声明式的接口                 |
| IEnumerator           | 用于迭代集合中的项，该接口是一种实现式的接口                 |
| ICollection           | .NET 提供的标准集合接口，所有的集合类都会直接或间接地实现这个接口 |
| IList                 | 继承自 IEnumerable 和 ICollection 接口，用于提供集合的项列表，并允许访问、查找集合中的项 |
| IDictionary           | 继承自 IEnumerable 和 ICollection 接口，与 IList 接口提供的功能类似，但集合中的项是以键值对的形式存取的 |
| IDictionaryEnumerator | 用于迭代 IDictionary 接口类型的集合                          |

针对上表中的接口有一些常用的接口实现类，如下表所示。

| **类名称**    | **实现接口**                                               | **特点**                                                     |
| ------------- | ---------------------------------------------------------- | ------------------------------------------------------------ |
| **ArrayList** | ICollection、IList、IEnumerable、ICloneable                | 集合中元素的个数是可变的，提供添加、删除等方法               |
| Queue         | ICollection、IEnumerable、ICloneable                       | 集合实现了先进先出的机制，即元素将在集合的尾部添加、在集合的头部移除 |
| Stack         | ICollection、IEnumerable、ICloneable                       | 集合实现了先进后出的机制，即元素将在集合的尾部添加、在集合的尾部移除 |
| **Hashtable** | IDictionary、ICollection、IEnumerable、 ICloneable 等接口  | 集合中的元素是以键值对的形式存放的，是 DictionaryEntry 类型的 |
| SortedList    | IDictionary、ICollection、IEnumerable、  ICloneable 等接口 | 与 Hashtable 集合类似，集合中的元素以键值对的形式存放，不同的是该集合会按照 key 值自动对集合中的元素排序 |

### ArrayList类：动态数组


C# ArrayList 类（动态数组）是一个最常用的集合类，与数组的操作方法也是最类似的。

**ArrayList 代表了可被单独索引的对象的有序集合。它基本上可以替代一个数组。**

但是，与数组不同的是，ArrayList 可以使用索引在指定的位置添加和移除项目，**动态数组会自动重新调整它的大小**。

同时 ArrayList 也允许在列表中进行动态内存分配、增加、搜索、排序各项。



#### 1、创建 ArrayList对象

创建 ArrayList 类的对象需要使用该类的构造方法，如下表所示。

| **构造方法**             | **作用**                                                     |
| ------------------------ | ------------------------------------------------------------ |
| ArrayList()              | 创建 ArrayList 的实例，集合的容量是默认初始容量              |
| ArrayList(ICollection c) | 创建 ArrayList 的实例，该实例包含从指定实例中复制的元素，并且初始容量与复制的元素个数相同 |
| ArrayList(int capacity)  | 创建 ArrayList 的实例，并设置其初始容量                      |

下面分别使用 ArrayList 类的构造器创建 ArrayList 实例，代码如下。

```C#
	ArrayList listl=new ArrayList();
	ArrayList list2=new ArrayList(listl);
	ArrayList list3=new ArrayList(20);
```

在创建 ArrayList 类的实例后，集合中还未存放值。

在 C# 语言中提供了集合初始化器，允许在创建集合实例时向集合中添加元素，代码如下。

```C#
	ArrayList list4 = new ArrayList(){l,2,3,4};
```

在{}中的值即集合中存入的值。



#### 2、遍历

集合与数组一样也能使用 foreach 语句遍历元素。

由于在集合中存放的值允许是任意类型，能使用 var 关键字来定义任意类型的变量。

遍历 list4 集合中的数据的代码如下。

```C#
	foreach(var v in list4)
	{
		Console.WriteLine(v);
	}
```

执行上面的代码，即可将集合 list4 中的元素输岀。

在 ArrayList 类中提供了很多属性和方法供开发人员调用，以便简化更多的操作。



#### 3、常用属性

ArrayList 类中常用的属性和方法如下表所示。

| **属性或方法**                                              | **作用**                                                     |
| ----------------------------------------------------------- | ------------------------------------------------------------ |
| Capacity                                                    | 属性，用于获取或设置集合中可以包含的元素个数                 |
| **Count**                                                   | 属性，用于获取集合中实际含有的元素个数                       |
| **int Add(object value)**                                   | 向集合中添加 object 类型的元素，返回元素在集合中的下标       |
| **void AddRange(ICollection c)**                            | 向集合中添加另一个集合 c                                     |
| **void Clear()**                                            | 从集合中移除所有元素                                         |
| **bool Contains(object item)**                              | 判断集合中是否含有 item 元素，若含有该元素则返回 True, 否则返回 False |
| void CopyTo(Array array)                                    | 从目标数组 array 的第 0 个位置开始，将整个集合中的元素复制到类型兼容的数组 array 中 |
| void CopyTo(Array array,int arraylndex)                     | 从目标数组 array 的指定索引 arraylndex 处，将整个集合中的元素赋值到类型兼容的数组 array 中 |
| void CopyTo(int index,Array array,int arrayIndex,int count) | 从目标数组 array 的指定索引 arrayindex 处，将集合中从指定索引 index 开始的count 个元素复制到类型兼容的数组 array 中 |
| int IndexOf(object value)                                   | 返回 value 值在集合中第一次出现的位置                        |
| int IndexOf(object value,int startIndex)                    | 返回 value 值在集合的 startindex 位置开始第一次出现的位置    |
| int IndexOf(object value,int startIndex,int count)          | 返回 value 值在集合的 startindex 位置开始 count 个元素中第一次出现的位置 |
| int LastIndexOf(object value)                               | 返回 value 值在集合中最后一次出现的位置                      |
| int LastIndexOf(object value,int startIndex)                | 返回 value 值在集合的 startindex 位置开始最后一次出现的位置  |
| int LastIndexOf(object value,int startIndex,int count)      | 入元素 value值在集合的 startindex 位置开始 count 个元素中最后一次出现的位置 |
| **void Insert(int index,object value)**                     | 返回 value 向集合中的指定索引 index 处插                     |
| void InsertRange(int index,ICollection c)                   | 向集合中的指定索引 index 处插入一个集合                      |
| **void Remove(object obj)**                                 | 将指定兀素 obj 从集合中移除                                  |
| **void RemoveAt(int index)**                                | 移除集合中指定位置 index 处的元素                            |
| void RemoveRange(int index,int count)                       | 移除集合中从指定位置 index 处的 count 个元素                 |
| **void Reverse()**                                          | 将集合中的元素顺序反转                                       |
| void Reverse(int index,int count)                           | 将集合中从指定位置 index 处的 count 个元素反转               |
| **void Sort()**                                             | 将集合中的元素排序，默认从小到大排序                         |
| **void Sort(IComparer comparer)**                           | 将集合中的元素按照比较器 comparer 的方式排序                 |
| void Sort(int index,int count,IComparer comparer)           | 将集合中的元素从指定位置 index 处的 count 个元素按照比较器 comparer 的方式排序 |
| void TrimToSize()                                           | 将集合的大小设置为集合中元素的实际个数                       |

下面通过实例来演示 ArrayList 类中属性和方法的使用。



#### 4、实例

定义 ArrayList 集合，在集合中存入任意值，完成如下操作。
查找集合中是否含有 abc 元素。
将集合中元素下标是偶数的元素添加到另一个集合中。
在集合中第一个元素的后面任意插入 3 个元素。
将集合中的元素使用 Sort 方法排序后输出。



##### 查找集合元素

【实例 1】是查找集合中的元素，使用 IndexOf 或者 LastlndexOf 都可以，代码如下。

```C#
	class Program
	{
		static void Main(string[] args)
		{
			ArrayList list = new ArrayList() { "aaa", "bbb", "abc", 123, 456 };
			int index = list.IndexOf("abc");
			if (index != -1)
			{
				Console.WriteLine("集合中存在 abc 元素！");
			}
			else
			{
				Console.WriteLine("集合中不存在 abc 元素！");
			}
		}
	}
```

执行上面的代码，查看效果。



##### 向集合中添加元素

【实例 2】将集合中下标为偶数的元素添加到另一个集合中，由于集合中共有 5 个元素，则所添加元素的下标分别为 0、2、4。

向集合中添加元素使用Add方法即可，代码如下。

```C#
	class Program
	{
		static void Main(string[] args)
		{
			ArrayList list = new ArrayList() { "aaa", "bbb", "abc", 123, 456 };
			ArrayList newList = new ArrayList();
			for(int i = 0; i < list.Count; i = i + 2)
			{
				newList.Add(list[i]);
			}
			foreach(var v in newList)
			{
				Console.WriteLine(v);
			}
		}
	}
```

执行上面的代码，查看效果。

从上面的执行效果可以看出，newList 集合中的元素是 list 集合中下标为偶数的元素。



##### **向集合中指定位置添加元素**

【实例 3】在集合中的第一个元素后面添加元素，使用 Insert 方法每次只能添加一个元素，但使用 InsertRange 方法能直接将一个集合插入到另一个集合中。

在本例中使用的是 InsertRange 方法，代码如下。

```C#
	class Program
	{
		static void Main(string[] args)
		{
			ArrayList list = new ArrayList() { "aaa", "bbb", "abc", 123, 456 };
			ArrayList insertList = new ArrayList() { "A", "B", "C" };
			list.InsertRange(1, insertList);
			foreach(var v in list)
			{
				Console.WriteLine(v);
			}
		}
	}
```

执行上面的代码，查看效果。

从上面的执行效果可以看出，已经在原有集合 list 中的第一个元素后面加入了 3 个元素。

【实例 4】将集合中的元素使用 Sort 方法排序后输出。

如果使用 Sort 方法对集合中的元素排序，则需要将集合中的元素转换为同一类型才能比较，否则会出现无法比较的异常。

这里创建一个 ArrayList，并在其中存入字符串类型的值，再使用 Sort 方法排序，代码如下。

```C#
	class Program
	{
		static void Main(string[] args)
		{
			ArrayList list = new ArrayList() { "aaa", "bbb", "abc" };
			list.Sort();
			foreach(var v in list)
			{
				Console.WriteLine(v);
			}
		}
	}
```

执行上面的代码，查看效果。



##### **对集合元素排序**

从上面的执行效果可以看出，Sort 方法将集合中的元素**按照字母的 ASCII 码**从小到大排序，相当于字母的顺序。

如果需要将所得到的值按照从大到小的顺序排序，则可以在使用过 Sort 方法后再使用 Reverse 方法将元素倒置。



字符串类型的值不能直接使用大于、小于的方式比较，要使用字符串的 CompareTo 方法，该方法的返回值是 int 类型，

语法形式如下。

​			**字符串1.CompareTo(字符串2);**

当字符串 1 与字符串 2 相等时结果为 0；

当字符串 1 的字符顺序在字符串 2 前面时结果为 -1;

当字符串 1 的字符顺序在字符串 2 后面时结果为1。



在由多个字符组成的字符串中，首先比较的是两个字符串的**首字母**，如果相同则比较第二个字符，依此类推，如果两个字符串的首字母不同，则不再比较后面的字符。

在 ArrayList 类中常用的属性和方法表中列出的 Sort 方法中，Sort 方法能传递 IComparer 类型的参数。

**IComparer** 类型的参数是**自定义的比较器**，要求使用一个类来实现 IComparer 接口，并实现其中的 Compare 方法。





下面通过实例来完成用自定义比较器实现排序的操作。

【实例 5】定义一个 ArrayList 类型的集合，并在其中任意存放 5 个值，使用 Sort 方法完成排序并输岀结果。

根据题目要求，由于没有在集合中指定统一的数据类型，需要用自定义比较器来完成排序，自定义比较器类 MyCompare，代码如下。

```C#
	class MyCompare :IComparer
	{
		public int Compare(object x,object y)
		{
			string str1 = x.ToString();
			string str2 = y.ToString();
			return str1.CompareTo(str2);
		}
	}
```

在上面的代码中，对于 Compare 方法，当比较的两个值 x 和 y 相等时返回 0,当 x>y 时返回值大于 0,当 x<y 时返回值小于 0。

由于 CompareTo 方法的返回值与 Compare 方法的返回值的计算方法相同，因此，直接返回 CompareTo 的比较结果即可满足对两个值从小到大的比较操作。

如果需要返回的是从大到小的比较结果，则只需要将比较的两个值调换顺序即可，即“return str2.CompareTo(strl);”。

在 ArrayList 集合中使用带自定义比较器的 Sort 方法，代码如下。

```C#
	class Program
	{
		static void Main(string[] args)
		{
			ArrayList list = new ArrayList() { "a", "b", "c", 1, 2 };
			MyCompare myCompare = new MyCompare();//创建自定义比较器实例
			list.Sort(myCompare);
			foreach(var v in list)
			{
				Console.WriteLine(v);
			}
		}
	}
```

执行上面的代码，查看效果。

使用带自定义比较器的sort方法

从上面的执行效果可以看出，虽然在 ArrayList 集合中存放了不同类型的值，但通过在自定义比较器中将所有的值转换为字符串类型并进行比较，使用 Sort 方法即可完成排序操作。

### Hashtable类：哈希表（散列表）

C# Hashtable 类实现了 IDictionary 接口，集合中的值都是以**键值对的形式**存取的。

C# 中的 Hashtable 称为哈希表，也称为散列表，在该集合中使用键值对（key/value）的形式存放值。

换句话说，在 Hashtable 中存放了**两个数组**，一个数组用于存放 key 值，一个数组用于存放 value 值。

此外，还提供了根据集合中元素的 key 值查找其对应的 value 值的方法。



Hashtable 类提供的构造方法有很多，最常用的是不含参数的构造方法，即通过如下代码来实例化 Hashtable 类。

```C#
    Hashtable 对象名 = new Hashtable ();
```



#### Hashtable常用属性和方法

Hashtable 类中常用的属性和方法如下表所示。

| **属性或方法**                    | **作用**                              |
| --------------------------------- | ------------------------------------- |
| Count                             | 集合中存放的元素的实际个数            |
| Keys                              | 获取集合中所有键，返回集合            |
| Values                            | 获取集合中所有值，返回集合            |
| void Add(object key,object value) | 向集合中添加元素                      |
| void Remove(object key)           | 根据指定的 key 值移除对应的集合元素   |
| void Clear()                      | 清空集合                              |
| ContainsKey (object key)          | 判断集合中是否包含指定 key 值的元素   |
| ContainsValue(object value)       | 判断集合中是否包含指定 value 值的元素 |

下面通过实例演示 Hashtable 类的使用。



#### Hashtable实例

【实例】使用 Hashtable 集合实现图书信息（编号、图书名称）的添加、查找以及遍历的操作。

根据题目要求，先向 Hashtable 集合中添加 3 个值，再根据所输入的 key 值查找图书名称，最后遍历所有的图书信息，代码如下。

```C#
    class Program
    {
        static void Main(string[] args)
        {
            Hashtable ht = new Hashtable();
            ht.Add(1, "计算机基础");
            ht.Add(2, "C#高级编程");
            ht.Add(3, "数据库应用");
            Console.WriteLine("请输入图书编号");
            int id = int.Parse(Console.ReadLine());
            bool flag = ht.ContainsKey(id);
            if (flag)
            {
                Console.WriteLine("您查找的图书名称为：{0}", ht[id].ToString());
            }
            else
            {
                Console.WriteLine("您查找的图书编号不存在！");
            }
            Console.WriteLine("所有的图书信息如下：");
            foreach(DictionaryEntry d in ht)
            {
                int key = (int)d.Key;
                string value = d.Value.ToString();
                Console.WriteLine("图书编号：{0}，图书名称：{1}", key, value);
            }
        }
    }
```

执行上面的代码，查看效果。

Hashtable的使用

从上面的执行效果可以看出，在使用 Hashtable 时能同时存放 key/value 的键值对，由于 **key 值是唯一**的，因此可以根据指定的 key 值查找 value 值。





## 二、C#泛型

我们在编程程序时，经常会遇到功能非常相似的模块，只是它们处理的数据不一样。

但我们没有办法，只能分别写多个方法来处理不同的数据类型。

这个时候，那么问题来了，有没有一种办法，用同一个方法来处理传入不同种类型参数的办法呢？泛型的出现就是专门来解决这个问题的。

泛型：**把类型明确的工作推迟到创建对象或调用方法的时候才去明确的特殊的类型**

参数化数据类型:

- **把数据类型当作是参数一样传递**

泛型是在 System.Collections.Generic 命名空间中的，用于约束类或方法中的参数类型。

泛型的应用非常广泛，包括方法、类以及集合等。

### C#泛型集合简介

**集合中的项允许是 object 型的值，因此可以存放任意类型的值。**

例如，在 ArrayList 中以 double 类型存入学生考试成绩，但存入值时并没有做验证，存入了其他数据类型的值，代码如下。

```C#
	ArrayList arrayList=new ArrayList();
	arrayList.Add(100);
	arrayList.Add("abc");
	arrayList.Add(85.5);
```

在输出集合中的元素时，如果使用 double 类型来遍历集合中的元素，代码如下。

```C#
	foreach (double d in arrayList)
	{
		Console.WriteLine(d);
	}
```

执行上面的代码，由于在集合中存放的并不全是 double 类型的值，因此会出现 System.InvalidCastException 异常，即指定的转换无效。

为了避免类似的情况产生，将集合中元素的类型都指定为 double 类型，**不能在集合中输入其他类型的值**，这种设置方式即为泛型的一种应用。




C# 语言中泛型集合是**泛型中最常见的应用**，主要用于**约束集合中存放的元素类型**。

由于在集合中**能存放任意类型的值**，在取值时经常会遇到**数据类型转换异常**的情况，因此**推荐**在定义集合时使用泛型集合。

非泛型集合中的 ArrayList、Hashtable 在泛型集合中分别使用 List<T> 和 Dictionary<TKey,TValue> 来表示，其他泛型集合均与非泛型集合一致。

下面以 List<T> 和 Dictionary<TKey,TValue>为例介绍泛型集合的使用。

### List< T >类

#### 定义语法

```C#
List<数据类型> 对象名 = new List<数据类型>();
```

例如：

```C#
		List<int> ints = new List<int>();
        List<string> strs = new List<string>();
        List<Student> list = new List<Student>();
```



【实例 1】使用泛型集合 List< T > 实现对学生信息的添加和遍历。

根据题目要求，将学生信息定义为一个类，并在该类中定义学号、姓名、年龄属性。

在泛型集合 List< T > 中添加学生信息类的对象，并遍历该集合。实现的代码如下。

```C#
	class Student
	{
		//提供有参构造方法，为属性赋值
		public Student(int id,string name,int age)
		{
			this.id = id;
			this.name = name;
			this.age = age;
		}
		//学号
		public int id { get; set; }
		//姓名
		public string name { get; set; }
		//年龄
		public int age { get; set; }
		//重写ToString 方法
		public override string ToString()
		{
			return id + "：" + name + "：" + age;
		}
	}

	class Program
	{
		static void Main(string[] args)
		{
			//定义泛型集合
			List<Student> list = new List<Student>();
			//向集合中存入3名学员
			list.Add(new Student(1, "小明", 20));
			list.Add(new Student(2, "小李", 21));
			list.Add(new Student(3, "小赵", 22));
			//遍历集合中的元素
			foreach(Student stu in list)
			{
				Console.WriteLine(stu);
			}
		}
	}
```

执行上面的代码，查看效果。

从上面的执行效果可以看出，在该泛型集合中存放的是 Student 类的对象，当从集合中取岀元素时并不需要将集合中元素的类型转换为 Student 类的类型，而是直接遍历集合中的元素即可，这也是泛型集合的一个特点。



###  Dictionary<TKey,TValue> 类

Dictionary<TKey,TValue>类的功能与HashTable类类似，也是通过键值对来存储元素。
TKey表示键的数据类型
TValue表示值的数据类型。

#### 定义语法

```C#
		Dictionary<键的数据类型,值的数据类型> 对象名 = new Dictionary<键的数据类型,值的数据类型>();
```



例如：

```C#
		Dictionary<int,string> dicname = new Dictionary<int,string>();
        Dictionary<string,string> dicstr = new Dictionary<string,string>();
        Dictionary<string,Student> dicstu = new Dictionary<string,Student>();
```



【实例 2】使用泛型集合Dictionary<TKey,TValue>实现学生信息的添加，并能够按照学号查询学生信息。

根据题目要求，将在实例 1 中所创建学生信息类的对象作为 Dictionary<TKey,TValue>集合中的 value 值部分，key 值部分使用学生信息类中的学号，这样能很容易地通过学号查询学生的信息。实现的代码如下。

```C#
class Program
{
	static void Main(string[] args)
	{
		Dictionary<int, Student> dictionary = new Dictionary<int, Student>();
		Student stu1 = new Student(1, "小明", 20);
		Student stu2 = new Student(2, "小李", 21);
		Student stu3 = new Student(3, "小赵", 22);
		dictionary.Add(stu1.id, stu1);
		dictionary.Add(stu2.id, stu2);
		dictionary.Add(stu3.id, stu3);
		Console.WriteLine("请输入学号：");
		int id = int.Parse(Console.ReadLine());
		if (dictionary.ContainsKey(id))
		{
			Console.WriteLine("学生信息为：{0}", dictionary[id]);
		}
		else
		{
			Console.WriteLine("您查找的学号不存在！");
		}
	}
}
```

执行上面的代码，查看效果。

从上面的执行效果可以看出，根据输入的学号直接从 Dictionary<int,Student> 泛型集合中查询出所对应的学生信息，并且在输出学生信息时不需要进行类型转换，直接输出其对应的 Student 类的对象值即可。





## 总结

1. 集合类ArrayList：动态数组，可以使用索引下标访问元素；可以同时存放任意类型的数据。

2. 集合类Hashtable：哈希表，键值对存储，通过键获取值；键唯一不能重复。
3. 泛型集合类List<T>：列表，与集合ArrayList类似，不同在于只能存放指定类型的数据。T代表存储数据的数据类型。
4. 泛型集合类 Dictionary<TKey,TValue>:字典，与集合Hashtable类似；TKey代表键的数据类型，TValue代表值的数据类型。