## C#流简介


在计算机编程中，流就是一个类的对象，很多文件的输入输出操作都以类的成员函数的方式来提供。

**计算机中的流其实是一种信息的转换。它是一种有序流，因此相对于某一对象，通常我们把对象接收外界的信息输入（Input）称为输入流，相应地从对象向外 输出（Output）信息为输出流，合称为输入/输出流（I/O Streams）。**

对象间进行信息或者数据的交换时总是先将对象或数据转换为某种形式的流，再通过流的传输，到达目的对象后再将流转换为对象数据。

所以， 可以**把流看作是一种数据的载体，通过它可以实现数据交换和传输**。

**流所在的命名空间也是System.IO，主要包括文本文件的读写、图像和声音文件的读写、二进制文件的读写等。**

在 System.IO 命名空间中提供了多种类，用于进行文件和数据流的读写操作。

要使用这些类，需要在程序的开头包含语句：**using System.IO**。

流是字节序列的抽象概念，例如文件、输入/输出设备、内部进程通信管道等。

流提供一种向后备存储器写入字节和从后备存储器读取字节的方式。

除了和磁盘文件直接相关的文件流以外，流还有多种类型。

例如数据流 (Stream) 是对串行传输数据的一种抽象表示，是对输入/输出的一种抽象。

数据有来源和目的地，衔接两者的就是串流对象。用比喻的方式来说或，数据就好比水，串流对象就好比水管，通过水管的衔接，水由一端流向另一端。

从应用程序的角度来说，如果将数据从来源取出，可以试用输入 ( 读 ) 串流，把数据储存在内存缓冲区；如果将数据写入目的地，可以使用输出 ( 写 ) 串流，把内存缓冲区的数据写入目的地。

当希望通过网络传输数据，或者对文件数据进行操作时，首先需要将数据转化为数据流。

典型的数据流和某个外部数据源相关，数据源可以是文件、外部设备、内存、网络套接字等。

根据数据源的不同，.Net 提供了多个从 Stream 类派生的子类，每个类代表一种具体的数据流类型，比如磁盘文件直接相关的文件流类 FileStream，和套接字相关的网络流类 NetworkStream，和内存相关的内存流类 MemoryStream 等。





## C# StreamReader类：读取文件


在 C# 语言中 **StreamReader 类用于从流中读取字符串**。它继承自 TextReader 类。

### **StreamReader 类常用的构造方法**

| 构造方法                                       | 说明                                                         |
| ---------------------------------------------- | ------------------------------------------------------------ |
| StreamReader(Stream stream)                    | 为指定的流创建 StreamReader 类的实例                         |
| **StreamReader(string path)**                  | 为指定路径的文件创建 StreamReader 类的实例                   |
| StreamReader(Stream stream, Encoding encoding) | 用指定的字符编码为指定的流初始化 StreamReader 类的一个新实例 |
| StreamReader(string path, Encoding encoding)   | 用指定的字符编码为指定的文件名初始化  StreamReader 类的一个新实例 |


使用该表中的构造方法即可创建 StreamReader 类的实例，通过实例调用其提供的类成 员能进行文件的读取操作。

### **StreamReader 类中的常用属性和方法**

| 属性或方法                                    | 作用                                                       |
| --------------------------------------------- | ---------------------------------------------------------- |
| Encoding CurrentEncoding                      | 只读属性，获取当前流中使用的编码方式                       |
| bool EndOfStream                              | 只读属性，获取当前的流位置是否在流结尾                     |
| **void Close()**                              | 关闭流                                                     |
| **int Peek()**                                | 获取流中的下一个字符的整数，如果没有获取到字符， 则返回 -1 |
| int Read()                                    | 获取流中的下一个字符的整数                                 |
| int Read(char[] buffer, int index, int count) | 从指定的索引位置开始将来自当前流的指定的最多字符读到缓冲区 |
| **string ReadLine()**                         | 从当前流中读取一行字符并将数据作为字符串返回               |
| **string ReadToEnd()**                        | 读取来自流的当前位置到结尾的所有字符                       |



###  StreamReader 类的应用

**【实例】读取 D 盘 code 文件夹下 test.txt 文件中的信息。**

根据题目要求，先在 D 盘下创建文件夹并创建 test.txt 文件，然后写入两行字符，分别是 Hello 和 Lucy，代码如下。

```c#
class Program
{
    static void Main(string[] args)
    {
        //定义文件路径
        string path = @"D:\\code\\test.txt";
        //创建 StreamReader 类的实例
        StreamReader streamReader = new StreamReader(path);
        //判断文件中是否有字符
        while (streamReader.Peek() != -1)
        {
            //读取文件中的一行字符
            string str = streamReader.ReadLine();
            Console.WriteLine(str);
        }
        streamReader.Close();
    }
}
```



在读取文件中的信息时，除了可以使用 ReadLine 方法以外，还可以使用Read、ReadToEnd方法来读取。



## C# StreamWriter类：写入文件

StreamWriter 类主要用于向流中写入数据。

### **StreamWriter 类常用的构造方法**

| 构造方法                                         | 说明                                                         |
| ------------------------------------------------ | ------------------------------------------------------------ |
| StreamWriter(Stream stream)                      | 为指定的流创建 StreamWriter 类的实例                         |
| **StreamWriter(string path)**                    | 为指定路径的文件创建 StreamWriter 类的实例                   |
| StreamWriter(Stream stream, Encoding encoding)   | 用指定的字符编码为指定的流初始化 StreamWriter 类的一个新实例 |
| **StreamWriter(string path, Encoding encoding)** | 用指定的字符编码为指定的文件名初始化 StreamWriter 类的一个新实例 |


在创建了 StreamWriter 类的实例后即可调用其类成员，完成向文件中写入信息的操作。

### **StreamWriter 类中常用的属性和方法**

| 属性或方法                        | 作用                               |
| --------------------------------- | ---------------------------------- |
| bool AutoFlush                    | 属性，获取或设置是否自动刷新缓冲区 |
| Encoding Encoding                 | 只读属性，获取当前流中的编码方式   |
| **void Close()**                  | 关闭流                             |
| **void Flush()**                  | 刷新缓冲区                         |
| void Write(string value)          | 将字符串写入流中                   |
| **void WriteLine(string value)**  | 将字符串换行写入流中               |
| Task WriteAsync(string value)     | 将字符串异步写入流中               |
| Task WriteLineAsync(string value) | 将字符串异步换行写入流中           |


在上表中给出的方法中，Write、WriteAsync、WriteLineAsync 方法还有很多不同类型写入的重载方法，这里没有一一列出。

###  StreamWriter 类的应用

**【实例】向 D 盘 code 文件夹的 test.txt 文件中写入姓名和手机号码。**

根据题目要求，代码如下。

```C#
class Program
{
    static void Main(string[] args)
    {
        string path = @"D:\\code\\test.txt";
        //创建StreamWriter 类的实例
        StreamWriter streamWriter = new StreamWriter(path);
        //向文件中写入姓名
        streamWriter.WriteLine("小张");
        //向文件中写入手机号
        streamWriter.WriteLine("13112345678");
        //刷新缓存
        streamWriter.Flush();
        //关闭流
        streamWriter.Close();
    }
}
```

执行上面的代码，即可将姓名和手机号码写入到名为 test.txt 的文件中。



## C# FileStream类：文件读写

在 C# 语言中文件读写流使用 FileStream 类来表示，**FileStream 类主要用于文件的读写**，不仅能读写普通的文本文件，还可以读取图像文件、声音文件等不同格式的文件。

**在创建 FileStream 类的实例时还会涉及多个枚举类型的值， 包括 FileAccess、FileMode、FileShare、FileOptions 等。**

```
FileAccess 枚举类型主要用于设置文件的访问方式，具体的枚举值如下。
		Read：以只读方式打开文件。
		Write：以写方式打开文件。
		ReadWrite：以读写方式打开文件。
```

```
FileMode 枚举类型主要用于设置文件打开或创建的方式，具体的枚举值如下。
		CreateNew：创建新文件，如果文件已经存在，则会抛出异常。
		Create：创建文件，如果文件不存在，则删除原来的文件，重新创建文件。
		Open：打开已经存在的文件，如果文件不存在，则会抛出异常。
		OpenOrCreate：打开已经存在的文件，如果文件不存在，则创建文件。
		Truncate：打开已经存在的文件，并清除文件中的内容，保留文件的创建日期。如果文件不存在，则会抛出异常。
		Append：打开文件，用于向文件中追加内容，如果文件不存在，则创建一个新文件。
```

```
FileShare 枚举类型主要用于设置多个对象同时访问同一个文件时的访问控制，具体的枚举值如下。
		None：谢绝共享当前的文件。
		Read：允许随后打开文件读取信息。
		ReadWrite：允许随后打开文件读写信息。
		Write：允许随后打开文件写入信息。
		Delete：允许随后删除文件。
		Inheritable：使文件句柄可由子进程继承。
```

```
FileOptions 枚举类型用于设置文件的高级选项，包括文件是否加密、访问后是否删除等，具体的枚举值如下。
		WriteThrough：指示系统应通过任何中间缓存、直接写入磁盘。
		None：指示在生成 System.IO.FileStream 对象时不应使用其他选项。
		Encrypted：指示文件是加密的，只能通过用于加密的同一用户账户来解密。
		DeleteOnClose：指示当不再使用某个文件时自动删除该文件。
		SequentialScan：指示按从头到尾的顺序访问文件。
		RandomAccess：指示随机访问文件。
		Asynchronous：指示文件可用于异步读取和写入。
```

### **FileStream 类常用的构造方法**

| 构造方法                                                     | 说明                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| FileStream(string path, FileMode mode)                       | 使用指定路径的文件、文件模式创建 FileStream 类的实例         |
| FileStream(string path, FileMode mode, FileAccess access)    | 使用指定路径的文件、文件打开模式、文件访问模式创建 FileStream 类的实例 |
| FileStream(string path, FileMode mode, FileAccess access, FileShare share) | 使用指定的路径、创建模式、读写权限和共享权限创建 FileStream 类的一个新实例 |
| FileStream(string path, FileMode mode, FileAccess access, FileShare share, int bufferSize, FileOptions options) | 使用指定的路径、创建模式、读写权限和共享权限、其他 文件选项创建 FileStream 类的实例 |



下面使用 FileStream 类的构造方法创建 FileStream 类的实例，语法形式如下。

```C# 
string path = "D:\\test.txt";
FileStream fileStream1 = new FileStream(path, FileMode.Open);
FileStream fileStream2 = new FileStream(path, FileMode.Open, FileAccess.Read);
FileStream fileStream3 = new FileStream(path, FileMode.Open, FileAccess.ReadWrite, FileShare.Read);
FileStream fileStream4 = new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.Read, 10, FileOptions.None);
```

在创建好 FileStream 类的实例后，即可调用该类中的成员完成读写数据的操作。

### **FileStream 类中常用的属性和方法**

| 属性或方法                                      | 作用                                                         |
| ----------------------------------------------- | ------------------------------------------------------------ |
| bool CanRead                                    | 只读属性，获取一个值，该值指示当前流是否支持读取             |
| bool CanSeek                                    | 只读属性，获取一个值，该值指示当前流是否支持查找             |
| bool CanWrite                                   | 只读属性，获取一个值，该值指示当前流是否支持写入             |
| bool IsAsync                                    | 只读属性，获取一个值，该值指示 FileStream 是异步还 是同步打开的 |
| long Length                                     | 只读属性，获取用字节表示的流长度                             |
| string Name                                     | 只读属性，获取传递给构造方法的 FileStream 的名称             |
| long Position                                   | 属性，获取或设置此流的当前位置                               |
| int Read(byte[] array, int offset, int count)   | 从流中读取字节块并将该数据写入给定缓冲区中                   |
| int ReadByte()                                  | 从文件中读取一个字节，并将读取位置提升一个字节               |
| long Seek(lorig offset, SeekOrigin origin)      | 将该流的当前位置设置为给定值                                 |
| void Lock(long position, long length)           | 防止其他进程读取或写入 System.IO.FileStream                  |
| void Unlock(long position, long length)         | 允许其他进程访问以前锁定的某个文件的全部或部分               |
| void Write(byte[] array, int offset, int count) | 将字节块写入文件流                                           |
| void WriteByte(byte value)                      | 将一个字节写入文件流中的当前位置                             |


​	
​	

###  FileStream 类的应用

**【实例 1】在 D 盘 code 文件夹的 student.txt 文件中写入学生的学号信息。**

根据题目要求，代码如下。

如果是中文的，bytes 数组的长度将不够用，改成使用**byte[] bytes= Encoding.UTF8.GetBytes(message)**;的方式将数据从字符串类型转换为字节类型。

```c#
class Program
{
    static void Main(string[] args)
    {
        //定义文件路径
        string path = @"D:\\code\\student.txt";
        //创建 FileStream 类的实例
        FileStream fileStream = new FileStream(path, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite);
        //定义学号
        string msg = "1710026";
        //将字符串转换为字节数组
        byte[] bytes = Encoding.UTF8.GetBytes(msg);
        //向文件中写入字节数组
        fileStream.Write(bytes, 0, bytes.Length);
        //刷新缓冲区
        fileStream.Flush();
        //关闭流
        fileStream.Close();
    }
}
```

执行上面的代码，即可将学生的学号写入到文件 student.txt 中。



**【实例 2】从 D 盘的 code 文件夹中将 student.txt 文件中的学号读取出来，并显示到控制台上。**

根据题目要求，代码如下。

```C#
class Program
{
    static void Main(string[] args)
    {
        //定义文件路径
        string path = @"D:\\code\\student.txt";
        //判断是否含有指定文件
        if (File.Exists(path))
        {
            FileStream fileStream = new FileStream(path, FileMode.Open, FileAccess.Read);
            //定义存放文件信息的字节数组
            byte[] bytes = new byte[fileStream.Length];
            //读取文件信息
            fileStream.Read(bytes, 0, bytes.Length);
            //将得到的字节型数组重写编码为字符型数组
            char[] c = Encoding.UTF8.GetChars(bytes);
            Console.WriteLine("学生的学号为：");
            //输出学生的学号
            Console.WriteLine(c);
            //关闭流
            fileStream.Close();
        }
        else
        {
            Console.WriteLine("您查看的文件不存在！");
        }
    }
}
```

从上面的执行效果可以看出，已经将文件 student.txt 中的学号信息读取出来。









