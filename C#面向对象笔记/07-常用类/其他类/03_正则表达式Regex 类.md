# C#正则表达式（Regex类）

**课程目标**

1. 了解正则表达式的组成

   

## 什么是正则表达式？

英文是Regular Expression，是计算机科学的一个重要概念，它使用一种数学算法来解决计算机程序中的文本检索、匹配等问题。

正则表达式语言是一种专门用于**字符串处理**的语言。

正则表达式并不是 C# 语言独有的，在**大多数的编程语言**中都是**支持**的，包括一些脚本语言也支持，例如 JavaScript、JQuery 等。

正则表达式是专门处理字符串操作的，其本身有固定的写法。

正则表达式的主要作用是验证**字符串**的值**是否满足一定的规则**，在页面输入数据验证方面的应用比较多。

例如验证输入的邮箱是否合法、输入的身份证号码是否合法、输入的用户名是否满足条件等。

Regex类封装了正则表达式的相关操作，使用该类需要引入命名空间**System.Text.RegularExpressions**

它主要可以帮我们解决下面的问题：

+ **检索：**通过正则表达式，从字符串中获取我们想要的部分。（提取）
+ **匹配：**判断给定的字符串，是否符合正则表达式的过滤逻辑。（判断）

```C#
	Regex.IsMatch();//用来【判断】给定的字符串是否匹配某个正则表达式
    Regex.Match();  //用来从给定的字符串中按照正则表达式的要求，【提取】【一个】匹配的字符串
    Regex.Matches();//用来从给定的字符串中按照正则表示式的要求，【提取】【所有】匹配的字符串
    Regex.Replace();//【替换】所有正则表达式匹配的字符串为另外一个字符串
	Regex.Split();//匹配拆分字符串成字符串数组
```

 ```c#
			Regex regex = new Regex("abc");
            string input = "asldfasfdabcasAfasdf";

            Console.WriteLine(regex.IsMatch(input));

            Console.WriteLine(Regex.IsMatch(input, "abc"));
            //Regex.IsMatch();
            //Regex.Match();
            //Regex.Matches();
            regex = new Regex(@"as\w");

            Match m = regex.Match(input);
            Console.WriteLine(m.Index +" "+ m.Value);


            MatchCollection mc =  regex.Matches(input);

            foreach (Match item in mc)
            {
                Console.WriteLine(item.Index + " " + item.Value);
            }

            String str = regex.Replace(input,"好好学习");
            //Regex.Replace();
            Console.WriteLine(str);

            string[] arr = regex.Split(input);

            Console.WriteLine(string.Join(",",arr));
 ```



## 模糊匹配

在正则表达式中，有三种类型的括号：方括号“[ ]”、花括号"{ }"、圆括号"( )"

​	方括号内，是需要匹配的字符。

​	花括号内，是指定匹配字符的数量。

​	圆括号是用来分组的。

​	“^”表示正则表达式的开始。

​	“$”表示正则表达式的结束。

```c#
Regex obj = new Regex("[a-z]{10}"); //搜索长度为10的a-z的字符串

//字符串前面加@，表示避免转义字符，字符串里面的转义符无效。
//如：
Console.WriteLine("你好\t吗？");
Console.WriteLine(@"你好\t吗？");
```



正则表达式的符号主要分为**元字符**和**表示重复的字符**，分别如下表所示。

正则表达式中的元字符

|**编号**|**字符**|**描述**|
|------|------|------|
|1	|.	|匹配除换行符以外的所有字符|
|2	|\w	|[a-z0-9A-Z_]  匹配字母、数字、下画线|
|3	|\s	|匹配空白符（空格）|
|4	|\d	|[0-9]  匹配数字|
|5	|\b	|匹配表达式的开始或结束|
|6	|^	|匹配表达式的开始|
|7	|$	|匹配表达式的结束|

正则表达式中表示重复的字符

|**编 号**|**字 符**|**描 述**|
|------|------|------|
|1	|*	|0次或多次字符|
|2	|?	|0次或1次字符|
|3	|+	|1次或多次字符|
|4	|{n}	|n次字符|
|5	|{n,M} 	|n到M次字符|
|6	|{n, }	|n次以上字符|

此外，在正则表达式中使用|分隔符表示多个正则表达式之间的**或者关系**，也就是在匹配某一个字符串时满足其中一个正则表达式即可。

例如使用正则表达式来验证身份证信息，第一代身份证是由 15 个数字构成的，第二代身份证是由 18 个数字构成的，正则表达式可以写成 \d{15}|\d{18}。

在 C# 语言中使用正则表达式时要用到 Regex 类,该类在 System.Text.RegularExpressions 名称空间中。

在 Regex 类中使用 IsMatch 方法判断所匹配的字符串是否满足正则表达式的要求。

【实例】匹配邮政编码

```C#
			while (true)
            {
                Console.WriteLine("请输入邮政编码：");
                string str = Console.ReadLine();

                //验证用户输入的是否是一个合法的字符串
                //注意要完全匹配哦，开始和结束。
                bool result = Regex.IsMatch(str,@"^[\d]{6}$");
                Console.WriteLine("给定的字符串是合法的邮政编码！{0}",result);
            }
```





【实例】在 Main 方法中从控制台输入一个邮箱，使用正则表达式判断其正确性。

根据题目要求，在本例中邮箱验证的正则表达式的写法是包含 @，在 @ 前面是字母或者数字、下画线，在 @ 后面也是字母或者数字、下画线，并且字母后面要含有.，在 . 后面还要加上字母或者数字、下画线。具体的代码如下。

```C#
	class Program
	{
		static void Main(string[] args)
		{
			while (true)
            {
                Console.WriteLine("请输入:");
                string email = Console.ReadLine();
                Regex regex = new Regex(@"^(\w)+(\.\w)*@(\w)+((\.\w+)+)$");
                if (regex.IsMatch(email))
                {
                    Console.WriteLine("正确!");
                }
                else
                {
                    Console.WriteLine("邮箱格式不正确。");
                }
            }
		}
	}

```

执行上面的代码，查看效果。

邮箱的正则表达式也有多种写法，上面的写法只是其中的一种，例如将实例中的\w替换成 [a-zA-Z0-9_]。



【实例】检验一个字符串是否是合法的日期格式，如1984-05-22就是合法的，2100-13-7就是不合法的。

具体要求如下：

+ 日期按顺序由年、月、日三部分组成，每部分之间用 “ - ” 隔开。
+ 年份必须是4位数字，且必须是19或20开头。
+ 月份必须是两位数字，1-9月必须写成01-09,。
+ 日期必须是两位数字，1-9日必须写成01-09。



```c#
string str1 = @"(19|20)\d{2}";
string str2 = @"(0[1-9]|1[0-2])"
string str3 = @"(0[1-9]|[12]\d|3[0-1])"
string str4 = @"^(19|20)\d{2}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[0-1])$";
```



此外，在 Regex 类中还提供了很多方法来操作正则表达式

|**字符**|**描述**|
|------|------|
|\	|转义字符，将一个具有特殊功能的字符转义为一个普通字符，或反过来|
|x&#124;y	|匹配x或y。例如，‘z&#124;food’能匹配“z”或“food”。‘(z&#124;f)ood’则匹配“zood”或“food”|
|[xyz]	|字符集合。匹配所包含的任意一个字符。例如，‘[abc]’可以匹配“plain”中的‘a’|
|[^xyz] 	|负值字符集合。匹配未包含的任意字符。例如， [\^xyz] 可以匹配“plain”中的‘p’|
|[a-z]	|匹配指定范围内的任意字符。例如，‘[a-z]’可以匹配'a'到'z'范围内的任意小写字母字符|
|[^a-z]	|匹配不在指定范围内的任意字符。例如，[\^a-z]可以匹配不在‘a’～‘z’'内的任意字符|
|\B	|匹配非单词边界|
|\D	|匹配一个非数字字符，等价于 [\^0-9]|
|\f 	|匹配一个换页符|
|\n	|匹配一个换行符|
|\r	|匹配一个回车符|
|\S	|匹配任何非空白字符|
|\t	|匹配一个制表符|
|\v	|匹配一个垂直制表符。等价于 \x0b 和 \cK|
|\W	|匹配任何非单词字符。等价于[\^A-Za-z0-9_]|

除了邮箱的正则表达式以外，还有一些常用的正则表达式，如下表所示。

|**编号**|**正则表达式**|**作用**|
|------|---------|------|
|1	|\d{15}&#124;\d{18}	|验证身份证号码（15位或18位）|
|2	|\d{3}-\d{8}&#124;\d{4}-\d{7}	|验证国内的固定电话（区号有3位或4位，并在区号和电话号码之 间加上-）|
|3	|^[1-9]\d*$ 	|验证字符串中都是正整数|
|4	|^-[1-9]\d*$	|验证字符串中都是负整数|
|5	|^-?[1-9]\d*$	|验证字符串中是整数|
|6	|^[A-Za-z]+$	|验证字符串中全是字母|
|7	|A[A-Za-z0-9]+$	|验证字符串由数字和字母构成|
|8	|[\u4e00-\u9fa5]	|匹配字符串中的中文|
|9	|[^\x00-\xff] 	|匹配字符串中的双字节字符（包括汉字）|





